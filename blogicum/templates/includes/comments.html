{% load django_bootstrap5 %}

{% if is_edit_comment %}
  <h5 class="mb-4">Редактировать комментарий</h5>
  <form method="post" action="{% url 'blog:edit_comment' post.id is_edit_comment.id %}">
    {% csrf_token %}
    {% bootstrap_form form %}
    {% bootstrap_button button_type="submit" content="Сохранить" %}
    <a href="{% url 'blog:post_detail' post.id %}" class="btn btn-secondary">Отмена</a>
  </form>
{% elif user.is_authenticated %}
  <h5 class="mb-4">Оставить комментарий</h5>
  <form method="post" action="{% url 'blog:add_comment' post.id %}">
    {% csrf_token %}
    {% bootstrap_form form %}
    {% bootstrap_button button_type="submit" content="Отправить" %}
  </form>
{% endif %}

<hr>

{% for comment in comments %}
  <div class="media card mb-4 p-3">
    <div class="media-body">
      <h5 class="mt-0">
        <a href="{% url 'blog:profile' comment.author.username %}">
          {{ comment.author.first_name }} {{ comment.author.last_name }}
        </a>
      </h5>
      <p>{{ comment.text|linebreaksbr }}</p>
      <small class="text-muted">{{ comment.created_at }}</small>

      {% if user == comment.author %}
        <div class="mt-2">
          <a class="btn btn-sm btn-primary" href="{% url 'blog:edit_comment' post.id comment.id %}">
            Редактировать
          </a>
          <form method="post" action="{% url 'blog:delete_comment' post.id comment.id %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
          </form>
        </div>
      {% endif %}
    </div>
  </div>
{% empty %}
  <p>Пока комментариев нет, станьте первым!</p>
{% endfor %}